# MarchProxy NLB Configuration Example

# Server settings
bind_addr: ":8080"
grpc_addr: "0.0.0.0"
grpc_port: 50051
metrics_addr: ":8082"

# Manager connection
manager_url: "http://api-server:8000"
cluster_api_key: "your-cluster-api-key-here"
registration_url: "http://api-server:8000/api/register"

# Rate limiting configuration
enable_rate_limiting: true
default_rate_limit: 10000.0    # 10k requests per second
default_burst_size: 20000.0    # 20k burst capacity

# Protocol-specific rate limit buckets
rate_limit_buckets:
  # HTTP traffic
  - name: "http_global"
    protocol: "http"
    capacity: 50000.0
    refill_rate: 10000.0

  # MySQL database traffic
  - name: "mysql_global"
    protocol: "mysql"
    capacity: 10000.0
    refill_rate: 2000.0

  # PostgreSQL database traffic
  - name: "postgresql_global"
    protocol: "postgresql"
    capacity: 10000.0
    refill_rate: 2000.0

  # MongoDB traffic
  - name: "mongodb_global"
    protocol: "mongodb"
    capacity: 15000.0
    refill_rate: 3000.0

  # Redis cache traffic
  - name: "redis_global"
    protocol: "redis"
    capacity: 100000.0
    refill_rate: 20000.0

  # RTMP streaming traffic
  - name: "rtmp_global"
    protocol: "rtmp"
    capacity: 5000.0
    refill_rate: 1000.0

# Autoscaling configuration
enable_autoscaling: true
autoscale_interval: 30s
scale_up_cooldown: 3m
scale_down_cooldown: 5m

# Blue/Green deployment configuration
enable_bluegreen: true
canary_step_size: 10           # 10% traffic increments
canary_step_duration: 2m       # 2 minutes between steps

# Module management
max_modules_per_protocol: 50
module_health_check_interval: 10s

# Advanced features
enable_connection_pooling: true
max_connections_per_module: 10000

# Observability
enable_tracing: false
jaeger_endpoint: "http://jaeger:14268/api/traces"
trace_sample_rate: 0.1
metrics_namespace: "marchproxy_nlb"

# Licensing (Enterprise features)
license_key: ""
license_server: "https://license.penguintech.io"
release_mode: false
