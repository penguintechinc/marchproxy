@version: 3.35
@include "scl.conf"

# Global options
options {
    chain_hostnames(off);
    flush_lines(0);
    use_dns(no);
    use_fqdn(no);
    owner("root");
    group("adm");
    perm(0640);
    stats_freq(0);
    bad_hostname("^gconfd$");
};

# Sources
source s_local {
    internal();
};

source s_network_udp {
    network(
        transport("udp")
        port(514)
        ip("0.0.0.0")
    );
};

source s_network_tcp {
    network(
        transport("tcp")
        port(514)
        ip("0.0.0.0")
    );
};

# Destinations
destination d_marchproxy {
    file("/var/log/marchproxy.log");
};

destination d_marchproxy_auth {
    file("/var/log/marchproxy-auth.log");
};

destination d_marchproxy_netflow {
    file("/var/log/marchproxy-netflow.log");
};

destination d_marchproxy_debug {
    file("/var/log/marchproxy-debug.log");
};

destination d_console {
    file("/dev/stdout");
};

# Filters
filter f_marchproxy {
    program("marchproxy-manager") or program("marchproxy-proxy");
};

filter f_auth {
    message("AUTH:") or message("AUTHENTICATION:");
};

filter f_netflow {
    message("NETFLOW:") or message("CONNECTION:");
};

filter f_debug {
    message("DEBUG:") or level(debug);
};

# Log statements
log {
    source(s_network_udp);
    source(s_network_tcp);
    filter(f_marchproxy);
    destination(d_marchproxy);
    destination(d_console);
};

log {
    source(s_network_udp);
    source(s_network_tcp);
    filter(f_marchproxy);
    filter(f_auth);
    destination(d_marchproxy_auth);
};

log {
    source(s_network_udp);
    source(s_network_tcp);
    filter(f_marchproxy);
    filter(f_netflow);
    destination(d_marchproxy_netflow);
};

log {
    source(s_network_udp);
    source(s_network_tcp);
    filter(f_marchproxy);
    filter(f_debug);
    destination(d_marchproxy_debug);
};

log {
    source(s_local);
    destination(d_console);
};