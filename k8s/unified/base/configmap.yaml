apiVersion: v1
kind: ConfigMap
metadata:
  name: marchproxy-config
  namespace: marchproxy
  labels:
    app.kubernetes.io/name: marchproxy
    app.kubernetes.io/component: config
data:
  # Database configuration
  DATABASE_HOST: "postgres"
  DATABASE_PORT: "5432"
  DATABASE_NAME: "marchproxy"

  # Redis configuration
  REDIS_HOST: "redis"
  REDIS_PORT: "6379"
  REDIS_DATABASE: "0"

  # API Server configuration
  API_SERVER_URL: "http://api-server:8000"
  XDS_SERVER: "api-server:18000"

  # Module gRPC endpoints
  ALB_GRPC: "proxy-alb:50051"
  DBLB_GRPC: "proxy-dblb:50052"
  AILB_GRPC: "proxy-ailb:50053"
  RTMP_GRPC: "proxy-rtmp:50054"

  # Observability
  JAEGER_ENABLED: "true"
  JAEGER_HOST: "jaeger"
  JAEGER_PORT: "6831"

  # License server
  LICENSE_SERVER_URL: "https://license.penguintech.io"

  # Logging
  LOG_LEVEL: "info"
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: marchproxy-nlb-config
  namespace: marchproxy
  labels:
    app.kubernetes.io/name: marchproxy
    app.kubernetes.io/component: nlb
data:
  # NLB specific configuration
  NLB_PORT: "7000"
  ADMIN_PORT: "7001"
  ENABLE_EBPF: "true"
  ENABLE_XDP: "false"
  ENABLE_AF_XDP: "false"
  RATE_LIMIT_ENABLED: "true"
  RATE_LIMIT_RPS: "10000"
  AUTO_SCALING_ENABLED: "true"
  SCALE_MIN_INSTANCES: "1"
  SCALE_MAX_INSTANCES: "10"
  BLUE_GREEN_ENABLED: "false"
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: marchproxy-alb-config
  namespace: marchproxy
  labels:
    app.kubernetes.io/name: marchproxy
    app.kubernetes.io/component: alb
data:
  # ALB (Envoy) specific configuration
  ENVOY_LOG_LEVEL: "info"
  NUM_WORKERS: "4"
  GRPC_PORT: "50051"
  MODULE_TYPE: "alb"
  RATE_LIMIT_ENABLED: "true"
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: marchproxy-dblb-config
  namespace: marchproxy
  labels:
    app.kubernetes.io/name: marchproxy
    app.kubernetes.io/component: dblb
data:
  # DBLB specific configuration
  GRPC_PORT: "50052"
  MODULE_TYPE: "dblb"
  ADMIN_PORT: "7002"
  POOL_SIZE: "100"
  POOL_MAX_OVERFLOW: "200"
  SQL_INJECTION_CHECK: "true"
  RATE_LIMIT_ENABLED: "true"
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: marchproxy-ailb-config
  namespace: marchproxy
  labels:
    app.kubernetes.io/name: marchproxy
    app.kubernetes.io/component: ailb
data:
  # AILB specific configuration
  GRPC_PORT: "50053"
  MODULE_TYPE: "ailb"
  HTTP_PORT: "7003"
  ADMIN_PORT: "7004"
  RAG_ENABLED: "false"
  RAG_VECTOR_STORE: "faiss"
  RATE_LIMIT_ENABLED: "true"
  RATE_LIMIT_RPM: "60"
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: marchproxy-rtmp-config
  namespace: marchproxy
  labels:
    app.kubernetes.io/name: marchproxy
    app.kubernetes.io/component: rtmp
data:
  # RTMP specific configuration
  GRPC_PORT: "50054"
  MODULE_TYPE: "rtmp"
  RTMP_PORT: "1935"
  ADMIN_PORT: "7005"
  FFMPEG_THREADS: "4"
  TRANSCODE_PRESET: "medium"
  VIDEO_CODEC: "x264"
  HLS_ENABLED: "true"
  HLS_SEGMENT_DURATION: "6"
  DASH_ENABLED: "false"
  RATE_LIMIT_ENABLED: "true"
